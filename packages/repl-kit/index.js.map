{"version":3,"sources":["../../lib/repl-kit/index.ts"],"sourcesContent":["export class Repl {\n  constructor(readonly lang: any) {}\n\n  prompt_width = 0;\n  prompt() {\n    this.prompt_width = 2;\n    process.stdout.write(\"> \");\n  }\n\n  async run() {\n    const { stdin, stdout } = process;\n    stdin.setRawMode(true);\n    stdin.setEncoding(\"utf8\");\n\n    console.log(\"help: ?⏎\");\n    console.log(\"exit: CTRL-d\");\n    stdin.resume();\n\n    let line = \"\";\n    this.prompt();\n\n    return new Promise((resolve) => {\n      stdin.on(\"data\", (key) => {\n        // console.log({ key });\n        stdin.pause();\n        if ([\"\\x04\"].includes(key.toString())) {\n          // CTRL-d\n          stdin.destroy();\n          resolve(undefined);\n        }\n        if (!key.toString().match(/[\\p{Cc}\\p{Cn}\\p{Cs}]+/gu)) {\n          line += key.toString();\n          stdout.write(key);\n        }\n        if (\"\\x1B[C\" == key.toString()) {\n          process.stdout.moveCursor(-1, 0);\n        }\n        if (\"\\x1B[D\" == key.toString()) {\n          process.stdout.moveCursor(1, 0);\n        }\n        if ([\"\\x7F\"].includes(key.toString())) {\n          line = line.substring(0, line.length - 1);\n          process.stdout.cursorTo(0);\n          process.stdout.clearLine(0);\n          this.prompt();\n          stdout.write(line);\n          // process.stdout.write(\"\\x08\");\n        }\n        if ([\"\\r\", \"\\n\"].includes(key.toString())) {\n          process.stdout.moveCursor(0, 1);\n          process.stdout.cursorTo(0);\n          console.log(\"\");\n          this.lang.run(\"repl\", line);\n          line = \"\";\n          this.prompt();\n        }\n        stdin.resume();\n      });\n    });\n  }\n}\n"],"mappings":"4dAAA,+CAAO,GAAM,GAAN,KAAW,CAChB,YAAqB,EAAW,CAAX,YAErB,kBAAe,CAFkB,CAGjC,QAAS,CACP,KAAK,aAAe,EACpB,QAAQ,OAAO,MAAM,IAAI,CAC3B,CAEA,KAAM,MAAM,CACV,GAAM,CAAE,QAAO,UAAW,QAC1B,EAAM,WAAW,EAAI,EACrB,EAAM,YAAY,MAAM,EAExB,QAAQ,IAAI,eAAU,EACtB,QAAQ,IAAI,cAAc,EAC1B,EAAM,OAAO,EAEb,GAAI,GAAO,GACX,YAAK,OAAO,EAEL,GAAI,SAAQ,AAAC,GAAY,CAC9B,EAAM,GAAG,OAAQ,AAAC,GAAQ,CAExB,EAAM,MAAM,EACR,CAAC,GAAM,EAAE,SAAS,EAAI,SAAS,CAAC,GAElC,GAAM,QAAQ,EACd,EAAQ,MAAS,GAEd,EAAI,SAAS,EAAE,MAAM,yBAAyB,GACjD,IAAQ,EAAI,SAAS,EACrB,EAAO,MAAM,CAAG,GAEd,AAAY,EAAI,SAAS,GAAzB,UACF,QAAQ,OAAO,WAAW,GAAI,CAAC,EAE7B,AAAY,EAAI,SAAS,GAAzB,UACF,QAAQ,OAAO,WAAW,EAAG,CAAC,EAE5B,CAAC,MAAM,EAAE,SAAS,EAAI,SAAS,CAAC,GAClC,GAAO,EAAK,UAAU,EAAG,EAAK,OAAS,CAAC,EACxC,QAAQ,OAAO,SAAS,CAAC,EACzB,QAAQ,OAAO,UAAU,CAAC,EAC1B,KAAK,OAAO,EACZ,EAAO,MAAM,CAAI,GAGf,CAAC,KAAM;AAAA,CAAI,EAAE,SAAS,EAAI,SAAS,CAAC,GACtC,SAAQ,OAAO,WAAW,EAAG,CAAC,EAC9B,QAAQ,OAAO,SAAS,CAAC,EACzB,QAAQ,IAAI,EAAE,EACd,KAAK,KAAK,IAAI,OAAQ,CAAI,EAC1B,EAAO,GACP,KAAK,OAAO,GAEd,EAAM,OAAO,CACf,CAAC,CACH,CAAC,CACH,CACF,EA5Da","names":[]}