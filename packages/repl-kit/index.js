"use strict";var l=Object.defineProperty;var T=Object.getOwnPropertyDescriptor;var B=Object.getOwnPropertyNames;var k=Object.prototype.hasOwnProperty;var i=(o,s)=>l(o,"name",{value:s,configurable:!0});var E=(o,s)=>{for(var r in s)l(o,r,{get:s[r],enumerable:!0})},R=(o,s,r,t)=>{if(s&&typeof s=="object"||typeof s=="function")for(let n of B(s))!k.call(o,n)&&n!==r&&l(o,n,{get:()=>s[n],enumerable:!(t=T(s,n))||t.enumerable});return o};var y=o=>R(l({},"__esModule",{value:!0}),o);var L={};E(L,{Repl:()=>x});module.exports=y(L);var e={hideCursor:"\x1B[?25l",showCursor:"\x1B[?25h",ctrlA:"",ctrlC:"",ctrlD:"",ctrlE:"",ctrlK:"\v",up:"\x1B[A",down:"\x1B[B",right:"\x1B[C",left:"\x1B[D",backspace:"\x7F",delete:"\x1B[3~",newline:`
`,return:"\r",reset:"\x1B[0m",bright:"\x1B[1m",dim:"\x1B[2m",underscore:"\x1B[4m",blink:"\x1B[5m",reverse:"\x1B[7m",hidden:"\x1B[8m",fgBlack:"\x1B[30m",fgRed:"\x1B[31m",fgGreen:"\x1B[32m",fgYellow:"\x1B[33m",fgBlue:"\x1B[34m",fgMagenta:"\x1B[35m",fgCyan:"\x1B[36m",fgWhite:"\x1B[37m",bgBlack:"\x1B[40m",bgRed:"\x1B[41m",bgGreen:"\x1B[42m",bgYellow:"\x1B[43m",bgBlue:"\x1B[44m",bgMagenta:"\x1B[45m",bgCyan:"\x1B[46m",bgWhite:"\x1B[47m"},f=i(o=>!o.match(/[\p{Cc}\p{Cn}\p{Cs}]+/gu),"isPrintable");var m=class{constructor(s,r){this.isError=s;this.isContinuation=r}get text(){return this.isError?"\xD7 ":this.isContinuation?"  ":"\xBB "}get markup(){return this.isError?`${e.fgRed}${this.text}${e.reset}`:`${e.dim}${this.text}${e.reset}`}get width(){return 2}};i(m,"Prompt");var d=class{constructor(){this._text=""}insert(s,r){let[t,n]=[this._text.substring(0,r),this._text.substring(r)];this._text=`${t}${s}${n}`}backspace(s){let[r,t]=[this._text.substring(0,s),this._text.substring(s)],n=r.substring(0,r.length-1);this._text=`${n}${t}`}clear(s){this._text=this._text.substring(0,s)}get text(){return this._text}};i(d,"Input");var u=class{constructor(s,r){this.cursor=0;this.prompt=new m(s,r),this.input=new d}render(){this.cursor=0,process.stdout.moveCursor(this.cursor,1),process.stdout.cursorTo(this.cursor),process.stdout.write(this.prompt.markup),process.stdout.write(this.input.text)}clearTilEnd(){this.input.clear(this.cursor),process.stdout.clearScreenDown()}insert(s){this.input.insert(s,this.cursor),process.stdout.clearLine(1);let r=this.input.text.substring(this.cursor);process.stdout.write(r),this.cursor+=s.length,process.stdout.moveCursor(-(r.length-s.length),0)}backspace(){if(this.cursor===0)return;this.input.backspace(this.cursor),this.cursor-=1,process.stdout.moveCursor(-1,0),process.stdout.clearLine(1);let s=this.input.text.substring(this.cursor);process.stdout.write(s),process.stdout.moveCursor(-s.length,0)}moveRight(s=1){this.cursor!==this.input.text.length&&(this.cursor+=s,process.stdout.moveCursor(s,0))}moveLeft(s=1){this.cursor!==0&&(this.cursor-=s,process.stdout.moveCursor(-s,0))}moveToLineStart(){this.moveLeft(this.cursor)}moveToLineEnd(){this.moveRight(this.input.text.length-this.cursor)}newline(){process.stdout.moveCursor(0,1),process.stdout.cursorTo(0),console.log("")}hideCursor(){process.stdout.write(e.hideCursor)}showCursor(){process.stdout.write(e.showCursor)}};i(u,"Line");var p=class{};i(p,"IncompleteException");var b=class{constructor(){this.commands=[""];this.pos=0}update(s){this.commands[this.pos]=s}save(){this.commands.push(""),this.pos+=1}next(){return this.goto(this.pos+1)}previous(){return this.goto(this.pos-1)}goto(s){return this.pos=Math.max(0,s),this.pos=Math.min(this.commands.length-1,this.pos),this.commands[this.pos]}};i(b,"History");var a=new b;function v(o,s){let r=[],t=new u(!1,!1);return t.render(),n=>{let h=n.toString(),w=i(()=>{f(h)&&t.insert(h)},"inserter"),C=i(()=>{if(t.input.text||t.prompt.isContinuation)try{let c=t.input.text;t.prompt.isContinuation&&(c=[...r,c].join(`
`)),o.run(c),t=new u(!1,!1),a.save(),r=[]}catch(c){c instanceof p?(r.push(t.input.text),t=new u(t.prompt.isError,!0)):t=new u(!0,t.prompt.isContinuation)}else t=new u(!1,!1);return t},"runner"),g={[e.ctrlA]:()=>t.moveToLineStart(),[e.ctrlC]:()=>{t.newline(),t.moveToLineStart(),t.clearTilEnd(),t.render()},[e.ctrlD]:()=>s(),[e.ctrlE]:()=>t.moveToLineEnd(),[e.ctrlK]:()=>t.clearTilEnd(),[e.up]:()=>{t.moveToLineStart(),t.clearTilEnd(),t.insert(a.previous())},[e.down]:()=>{t.moveToLineStart(),t.clearTilEnd(),t.insert(a.next())},[e.right]:()=>t.moveRight(),[e.left]:()=>t.moveLeft(),[e.backspace]:()=>t.backspace(),[e.return]:()=>{t.newline(),C(),t.render()},[e.delete]:()=>{t.moveRight(),t.backspace()}};t.hideCursor(),g[h]?g[h]():w(),t.showCursor(),a.update(t.input.text.trim())}}i(v,"lineKeyBinder");var x=class{constructor(s){this.lang=s}spashScreen(){console.log("help: ?\u23CE"),console.log("exit: CTRL-d")}async run(){return process.stdin.setRawMode(!0),process.stdin.setEncoding("utf8"),this.spashScreen(),process.stdin.resume(),new Promise(s=>{let r=v(this.lang,()=>{process.stdin.destroy(),s(void 0)});process.stdin.on("data",t=>{r(t),process.stdin.resume()})})}};i(x,"Repl");0&&(module.exports={Repl});
//# sourceMappingURL=index.js.map