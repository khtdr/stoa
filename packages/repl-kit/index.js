"use strict";var d=Object.defineProperty;var B=Object.getOwnPropertyDescriptor;var k=Object.getOwnPropertyNames;var E=Object.prototype.hasOwnProperty;var i=(e,s)=>d(e,"name",{value:s,configurable:!0});var R=(e,s)=>{for(var r in s)d(e,r,{get:s[r],enumerable:!0})},y=(e,s,r,t)=>{if(s&&typeof s=="object"||typeof s=="function")for(let n of k(s))!E.call(e,n)&&n!==r&&d(e,n,{get:()=>s[n],enumerable:!(t=B(s,n))||t.enumerable});return e};var L=e=>y(d({},"__esModule",{value:!0}),e);var w=(e,s,r)=>new Promise((t,n)=>{var a=u=>{try{h(r.next(u))}catch(c){n(c)}},v=u=>{try{h(r.throw(u))}catch(c){n(c)}},h=u=>u.done?t(u.value):Promise.resolve(u.value).then(a,v);h((r=r.apply(e,s)).next())});var $={};R($,{Repl:()=>f});module.exports=L($);var o={hideCursor:"\x1B[?25l",showCursor:"\x1B[?25h",ctrlA:"",ctrlC:"",ctrlD:"",ctrlE:"",ctrlK:"\v",up:"\x1B[A",down:"\x1B[B",right:"\x1B[C",left:"\x1B[D",backspace:"\x7F",delete:"\x1B[3~",newline:`
`,return:"\r",reset:"\x1B[0m",bright:"\x1B[1m",dim:"\x1B[2m",underscore:"\x1B[4m",blink:"\x1B[5m",reverse:"\x1B[7m",hidden:"\x1B[8m",fgBlack:"\x1B[30m",fgRed:"\x1B[31m",fgGreen:"\x1B[32m",fgYellow:"\x1B[33m",fgBlue:"\x1B[34m",fgMagenta:"\x1B[35m",fgCyan:"\x1B[36m",fgWhite:"\x1B[37m",bgBlack:"\x1B[40m",bgRed:"\x1B[41m",bgGreen:"\x1B[42m",bgYellow:"\x1B[43m",bgBlue:"\x1B[44m",bgMagenta:"\x1B[45m",bgCyan:"\x1B[46m",bgWhite:"\x1B[47m"},C=i(e=>!e.match(/[\p{Cc}\p{Cn}\p{Cs}]+/gu),"isPrintable");var b=class{constructor(s,r){this.isError=s;this.isContinuation=r}get text(){return this.isError?"\xD7 ":this.isContinuation?"  ":"\xBB "}get markup(){return this.isError?`${o.fgRed}${this.text}${o.reset}`:`${o.dim}${this.text}${o.reset}`}get width(){return 2}};i(b,"Prompt");var x=class{constructor(){this._text=""}insert(s,r){let[t,n]=[this._text.substring(0,r),this._text.substring(r)];this._text=`${t}${s}${n}`}backspace(s){let[r,t]=[this._text.substring(0,s),this._text.substring(s)],n=r.substring(0,r.length-1);this._text=`${n}${t}`}clear(s){this._text=this._text.substring(0,s)}get text(){return this._text}};i(x,"Input");var p=class{constructor(s,r){this.cursor=0;this.prompt=new b(s,r),this.input=new x}render(){this.cursor=0,process.stdout.moveCursor(this.cursor,1),process.stdout.cursorTo(this.cursor),process.stdout.write(this.prompt.markup),process.stdout.write(this.input.text)}clearTilEnd(){this.input.clear(this.cursor),process.stdout.clearScreenDown()}insert(s){this.input.insert(s,this.cursor),process.stdout.clearLine(1);let r=this.input.text.substring(this.cursor);process.stdout.write(r),this.cursor+=s.length,process.stdout.moveCursor(-(r.length-s.length),0)}backspace(){if(this.cursor===0)return;this.input.backspace(this.cursor),this.cursor-=1,process.stdout.moveCursor(-1,0),process.stdout.clearLine(1);let s=this.input.text.substring(this.cursor);process.stdout.write(s),process.stdout.moveCursor(-s.length,0)}moveRight(s=1){this.cursor!==this.input.text.length&&(this.cursor+=s,process.stdout.moveCursor(s,0))}moveLeft(s=1){this.cursor!==0&&(this.cursor-=s,process.stdout.moveCursor(-s,0))}moveToLineStart(){this.moveLeft(this.cursor)}moveToLineEnd(){this.moveRight(this.input.text.length-this.cursor)}newline(){process.stdout.moveCursor(0,1),process.stdout.cursorTo(0),console.log("")}hideCursor(){process.stdout.write(o.hideCursor)}showCursor(){process.stdout.write(o.showCursor)}};i(p,"Line");var l=class{};i(l,"IncompleteException");var g=class{constructor(){this.commands=[""];this.pos=0}update(s){this.commands[this.pos]=s}save(){this.commands.push(""),this.pos+=1}next(){return this.goto(this.pos+1)}previous(){return this.goto(this.pos-1)}goto(s){return this.pos=Math.max(0,s),this.pos=Math.min(this.commands.length-1,this.pos),this.commands[this.pos]}};i(g,"History");var m=new g;function T(e,s){let r=[],t=new p(!1,!1);return t.render(),n=>{let a=n.toString(),v=i(()=>{C(a)&&t.insert(a)},"inserter"),h=i(()=>{if(t.input.text||t.prompt.isContinuation)try{let c=t.input.text;t.prompt.isContinuation&&(c=[...r,c].join(`
`)),e.run(c),t=new p(!1,!1),m.save(),r=[]}catch(c){c instanceof l?(r.push(t.input.text),t=new p(t.prompt.isError,!0)):t=new p(!0,t.prompt.isContinuation)}else t=new p(!1,!1);return t},"runner"),u={[o.ctrlA]:()=>t.moveToLineStart(),[o.ctrlC]:()=>{t.newline(),t.moveToLineStart(),t.clearTilEnd(),t.render()},[o.ctrlD]:()=>s(),[o.ctrlE]:()=>t.moveToLineEnd(),[o.ctrlK]:()=>t.clearTilEnd(),[o.up]:()=>{t.moveToLineStart(),t.clearTilEnd(),t.insert(m.previous())},[o.down]:()=>{t.moveToLineStart(),t.clearTilEnd(),t.insert(m.next())},[o.right]:()=>t.moveRight(),[o.left]:()=>t.moveLeft(),[o.backspace]:()=>t.backspace(),[o.return]:()=>{t.newline(),h(),t.render()},[o.delete]:()=>{t.moveRight(),t.backspace()}};t.hideCursor(),u[a]?u[a]():v(),t.showCursor(),m.update(t.input.text.trim())}}i(T,"lineKeyBinder");var f=class{constructor(s){this.lang=s}spashScreen(){console.log("help: ?\u23CE"),console.log("exit: CTRL-d")}run(){return w(this,null,function*(){return process.stdin.setRawMode(!0),process.stdin.setEncoding("utf8"),this.spashScreen(),process.stdin.resume(),new Promise(s=>{let r=T(this.lang,()=>{process.stdin.destroy(),s(void 0)});process.stdin.on("data",t=>{r(t),process.stdin.resume()})})})}};i(f,"Repl");0&&(module.exports={Repl});
//# sourceMappingURL=index.js.map