"use strict";var m=Object.defineProperty;var N=Object.getOwnPropertyDescriptor;var O=Object.getOwnPropertyNames;var C=Object.prototype.hasOwnProperty;var i=(n,e)=>m(n,"name",{value:e,configurable:!0});var U=(n,e)=>{for(var r in e)m(n,r,{get:e[r],enumerable:!0})},D=(n,e,r,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of O(e))!C.call(n,s)&&s!==r&&m(n,s,{get:()=>e[s],enumerable:!(o=N(e,s))||o.enumerable});return n};var G=n=>D(m({},"__esModule",{value:!0}),n);var E={};U(E,{IncompleteParseTree:()=>b,InvalidParseTree:()=>L,Language:()=>y,ParseError:()=>k,Parser:()=>T,RuntimeError:()=>S,StdErrReporter:()=>f,Token:()=>g,TokenStream:()=>x,TokenStreamClass:()=>v,Tokens:()=>j,Visitor:()=>R});module.exports=G(E);var y=class{constructor(e=new f){this.reporter=e;this.opts={stage:"eval"};this.errored=!1}get interpreter(){return this._interpreter||(this._interpreter=new this.Interpreter(this.reporter)),this._interpreter}get resolver(){return this._resolver||(this._resolver=new this.Resolver(this.reporter,this.interpreter)),this._resolver}options(e){this.opts=e}run(e,r){this.errored=!1,this.reporter.pushSource(e,r),this.runToStage(r),this.reporter.popSource()}runToStage(e){let r=new this.Tokenizer(e,this.reporter),o=r.drain();if(this.reporter.errors&&(this.errored=!0,this.reporter.tokenError()),this.opts.stage==="scan"){r.print(o);return}let s=new this.Parser(o,this.reporter),t=s.parse();if(this.reporter.errors){this.errored=!0,this.reporter.parseError();return}if(!!t){if(this.resolver.visit(t),this.reporter.errors){this.errored=!0,this.reporter.parseError();return}if(this.opts.stage=="parse"){s.print(t);return}this.errored||(this.interpreter.visit(t),this.reporter.errors&&(this.errored=!0,this.reporter.runtimeError()))}}};i(y,"Language");var $="__stoa__::error",g=class{constructor(e,r,o){this.name=e;this.text=r;this.pos=o}toString(){let e=`[${this.pos.line},${this.pos.column}]`;return`${this.name}${e}`}};i(g,"Token");var x=class{constructor(e,r,o,s=1,t=1){this.reporter=o;this.buffer=[];this.eof=!1;this.generator=H(e,r,o,s,t)}take(){return this.peek(),this.buffer.shift()}peek(){return this.buffer.length||this.buffer.push(this.next()),this.buffer[0]}drain(){let e,r=[];for(;e=this.take();)r.push(e);return r}print(e=this.buffer,r="log"){console[r](e.map(o=>`${o}`).join(`
`))}next(){for(;;){if(this.eof)return;let e=this.generator.next().value;if(!e){this.eof=!0;continue}if(e.name==$){this.reporter.error(e,"Unrecognized input");continue}if(!e.name.toString().startsWith("_"))return e}}};i(x,"TokenStream");var v=class extends x{constructor(e,r){super(e,{},r)}};i(v,"TokenStreamClass");function*H(n,e,r,o,s){let t=0,a=o,p=s;for(;t<n.length;){let[h=$,u=n[t]]=A(_()),c=new g(h,u,l()),d=u.split(`
`).length;d>1?(a+=d-1,p=u.length-u.lastIndexOf(`
`)):p+=u.length,t+=u.length,yield c}function l(){return{line:a,column:p}}i(l,"pos");function A(h){return h.length?h.length==1?h[0]:h.reduce((u,c)=>c[1].length>u[1].length||c[1].length==u[1].length&&!c[2]&&u[2]?c:u):[]}i(A,"longest");function _(){let h=[];return Object.entries(e).map(([u,c])=>{if(typeof c=="function"){let d=c(n.substring(t),r,a,p);d!==void 0&&h.push([u,d,!1])}else if(typeof c!="string"){let d=c.source[c.source.length-1]=="*",w=new RegExp(`^${c.source}`,c.flags).exec(n.substring(t));if(w)return h.push([u,w[0],d])}else if(n.substring(t,t+c.length)==c)return h.push([u,c,!1])}),h}i(_,"possible")}i(H,"tokenGenerator");var j={STRINGS:{STD:B},COMMENTS:{SHEBANG:/\#\!\/usr\/bin\/env\s.*/,DOUBLE_SLASH:/\/\/.*/,C_STYLE:z},SPACE:{ALL:/\s+/}};function z(n,e,r,o){let s=new x(n,{OPEN:"/*",CLOSE:"*/",ESCAPED_CHAR:/\\./,CHAR:/.|\s/},e,r,o),t=s.take();if(t&&t.name=="OPEN"){let a=0,p,l=t.text;for(;p=s.take();)if(l+=p.text,p.name=="OPEN")a+=1;else if(p.name=="CLOSE")if(a)a-=1;else return l;return e.error(t,"Unclosed comment"),l}}i(z,"cStyleCommentScanner");function B(n,e,r,o){let s=new x(n,{SINGLE:"'",DOUBLE:'"',ESCAPED_CHAR:/\\./,CHAR:/.|\s/},e,r,o),t=s.take();if(t&&["SINGLE","DOUBLE"].includes(t.name)){let{text:a}=t,p;for(;p=s.take();)if(a+=p.text,p.name==t.name)return a;return e.error(t,`Unclosed string, expected ${t.text}`),a}}i(B,"stringScanner");var T=class{constructor(e,r){this.tokens=e;this.reporter=r;this.current=0}parse(){}print(e,r="log"){console[r](`${e??""}`)}match(...e){for(let r of e)if(this.check(r))return this.advance(),!0;return!1}consume(e,r){if(this.check(e))return this.advance();throw this.error(r)}error(e,r){let o=r||this.peek()||this.previous(),s=new L(e);if(!this.peek()){let t=o.text.split(`
`),a=t.length-1,p=o.pos.line+a,l=a?t[t.length-1].length+1:o.pos.column+o.text.length;o=new g("<EOF>","",{line:p,column:l}),s=new b(e)}return this.reporter.error(o,e),s}check(e){var r;return((r=this.peek())==null?void 0:r.name)==e}atEnd(){var e;return!((e=this.peek())!=null&&e.name)}advance(){return this.atEnd()||this.current++,this.previous()}peek(e=1){return this.tokens[this.current+(e-1)]}previous(){return this.tokens[this.current-1]}};i(T,"Parser");var R=class{constructor(e=new f,r){this.reporter=e;this.interpreter=r}visit(e){let r=e.constructor.name,o=this[r];if(typeof o=="function")return o.bind(this)(e);throw new Error(`Unvisitable node: ${r} (UNIMPLEMENTED BY AUTHOR)`)}};i(R,"Visitor");var k=class extends Error{};i(k,"ParseError");var L=class extends k{};i(L,"InvalidParseTree");var b=class extends k{};i(b,"IncompleteParseTree");var f=class{constructor(){this.files=[];this._errors=[]}pushSource(e,r){this.files.push([e,r])}popSource(){this.files.pop()}error(e,r){this._errors.push([e,r])}get errors(){return this._errors.length?this._errors:!1}tokenError(){this.reportErrors("Syntax")}parseError(){this.reportErrors("Parse")}runtimeError(){this.reportErrors("Runtime")}reportErrors(e){let[r,o]=this.files[this.files.length-1],s=o.split(`
`);for(let[t,a]of this._errors){this.log(`${e} error in ${r} at line,col ${t.pos.line},${t.pos.column}`);let p=`${t.pos.line}. `,l=`${s[t.pos.line-1]}`;this.log(`${p}${l}`);let _=`${p}${l}`.replace(/./g," ").substring(0,p.length+t.pos.column-1);this.log(`${_}\u2191`),this.log(`${a}`)}this._errors=[]}log(e){console.error(e)}};i(f,"StdErrReporter");var S=class extends Error{constructor(r,o){super(o);this.token=r}};i(S,"RuntimeError");0&&(module.exports={IncompleteParseTree,InvalidParseTree,Language,ParseError,Parser,RuntimeError,StdErrReporter,Token,TokenStream,TokenStreamClass,Tokens,Visitor});
//# sourceMappingURL=index.js.map