"use strict";var B=Object.defineProperty;var o=(n,e)=>B(n,"name",{value:e,configurable:!0});var u=class{};o(u,"IncompleteException");var a=class{};o(a,"InvalidException");var s={hideCursor:"\x1B[?25l",showCursor:"\x1B[?25h",ctrlA:"",ctrlC:"",ctrlD:"",ctrlE:"",ctrlK:"\v",up:"\x1B[A",down:"\x1B[B",right:"\x1B[C",left:"\x1B[D",backspace:"\x7F",delete:"\x1B[3~",newline:`
`,return:"\r",reset:"\x1B[0m",bright:"\x1B[1m",dim:"\x1B[2m",underscore:"\x1B[4m",blink:"\x1B[5m",reverse:"\x1B[7m",hidden:"\x1B[8m",fgBlack:"\x1B[30m",fgRed:"\x1B[31m",fgGreen:"\x1B[32m",fgYellow:"\x1B[33m",fgBlue:"\x1B[34m",fgMagenta:"\x1B[35m",fgCyan:"\x1B[36m",fgWhite:"\x1B[37m",bgBlack:"\x1B[40m",bgRed:"\x1B[41m",bgGreen:"\x1B[42m",bgYellow:"\x1B[43m",bgBlue:"\x1B[44m",bgMagenta:"\x1B[45m",bgCyan:"\x1B[46m",bgWhite:"\x1B[47m"},w=o(n=>!n.match(/[\p{Cc}\p{Cn}\p{Cs}]+/gu),"isPrintable");var d=class{constructor(e,r){this.isError=e;this.isContinuation=r}get text(){return this.isError?"\xD7 ":this.isContinuation?"  ":"\xBB "}get markup(){return this.isError?`${s.fgRed}${this.text}${s.reset}`:`${s.dim}${this.text}${s.reset}`}get width(){return 2}};o(d,"Prompt");var b=class{constructor(){this._text=""}insert(e,r){let[t,c]=[this._text.substring(0,r),this._text.substring(r)];this._text=`${t}${e}${c}`}backspace(e){let[r,t]=[this._text.substring(0,e),this._text.substring(e)],c=r.substring(0,r.length-1);this._text=`${c}${t}`}clear(e){this._text=this._text.substring(0,e)}get text(){return this._text}};o(b,"Input");var i=class{constructor(e,r){this.cursor=0;this.prompt=new d(e,r),this.input=new b}render(){this.cursor=0,process.stdout.moveCursor(this.cursor,1),process.stdout.cursorTo(this.cursor),process.stdout.write(this.prompt.markup),process.stdout.write(this.input.text)}clearTilEnd(){this.input.clear(this.cursor),process.stdout.clearScreenDown()}insert(e){this.input.insert(e,this.cursor),process.stdout.clearLine(1);let r=this.input.text.substring(this.cursor);process.stdout.write(r),this.cursor+=e.length,process.stdout.moveCursor(-(r.length-e.length),0)}backspace(){if(this.cursor===0)return;this.input.backspace(this.cursor),this.cursor-=1,process.stdout.moveCursor(-1,0),process.stdout.clearLine(1);let e=this.input.text.substring(this.cursor);process.stdout.write(e),process.stdout.moveCursor(-e.length,0)}moveRight(e=1){this.cursor!==this.input.text.length&&(this.cursor+=e,process.stdout.moveCursor(e,0))}moveLeft(e=1){this.cursor!==0&&(this.cursor-=e,process.stdout.moveCursor(-e,0))}moveToLineStart(){this.moveLeft(this.cursor)}moveToLineEnd(){this.moveRight(this.input.text.length-this.cursor)}newline(){process.stdout.moveCursor(0,1),process.stdout.cursorTo(0),console.log("")}hideCursor(){process.stdout.write(s.hideCursor)}showCursor(){process.stdout.write(s.showCursor)}};o(i,"Line");var x=class{constructor(){this.commands=[""];this.pos=0}update(e){this.commands[this.pos]=e}save(){this.commands.push(""),this.pos+=1}next(){return this.goto(this.pos+1)}previous(){return this.goto(this.pos-1)}goto(e){return this.pos=Math.max(0,e),this.pos=Math.min(this.commands.length-1,this.pos),this.commands[this.pos]}};o(x,"History");var l=new x;function v(n,e){let r=[],t=new i(!1,!1);return t.render(),c=>{let h=c.toString(),C=o(()=>{w(h)&&t.insert(h)},"inserter"),T=o(()=>{if(t.input.text||t.prompt.isContinuation)try{let p=t.input.text;t.prompt.isContinuation&&(p=[...r,p].join(`
`)),n.run(p),t=new i(!1,!1),l.save(),r=[]}catch(p){p instanceof u?(r.push(t.input.text),t=new i(t.prompt.isError,!0)):t=new i(!0,t.prompt.isContinuation)}else t=new i(!1,!1);return t},"runner"),f={[s.ctrlA]:()=>t.moveToLineStart(),[s.ctrlC]:()=>{t.newline(),t.moveToLineStart(),t.clearTilEnd(),t.render()},[s.ctrlD]:()=>e(),[s.ctrlE]:()=>t.moveToLineEnd(),[s.ctrlK]:()=>t.clearTilEnd(),[s.up]:()=>{t.moveToLineStart(),t.clearTilEnd(),t.insert(l.previous())},[s.down]:()=>{t.moveToLineStart(),t.clearTilEnd(),t.insert(l.next())},[s.right]:()=>t.moveRight(),[s.left]:()=>t.moveLeft(),[s.backspace]:()=>t.backspace(),[s.return]:()=>{t.newline(),T(),t.render()},[s.delete]:()=>{t.moveRight(),t.backspace()}};t.hideCursor(),f[h]?f[h]():C(),t.showCursor(),l.update(t.input.text.trim())}}o(v,"lineKeyBinder");var m=class{constructor(e){this.lang=e}spashScreen(){console.log("help: ?\u23CE"),console.log("exit: CTRL-d")}async run(){return process.stdin.setRawMode(!0),process.stdin.setEncoding("utf8"),this.spashScreen(),process.stdin.resume(),new Promise(e=>{let r=v(this.lang,()=>{process.stdin.destroy(),e(void 0)});process.stdin.on("data",t=>{r(t),process.stdin.resume()})})}};o(m,"Repl");var g=class{constructor(e){this.name=e}run(e){let r=e.trim();if(!!r){if(r.match(/[<{}>]/))throw new a;if(!r.endsWith(";"))throw new u;console.log(e)}}};o(g,"Lang");var R=new m(new g("sentences"));R.run();
//# sourceMappingURL=demo.js.map